  
**Identify products that have never been sold in any store.**
```sql
select \*  
from products  
where product\_id NOT IN (select   
                         DISTINCT product\_id  
                        from global\_sales  
                         )
```
**Find stores where the total sales revenue is higher than the average revenue across all stores.**
```sql
select store\_id,  
sum(net\_sales) as total\_revenue  
from sales  
group by store\_id  
having sum(net\_sales) \> (select   
                         sum(net\_sales) / (select   
                                           count (distinct store\_id)  
                                            from sales) as avg\_sales   
                                             from sales)
```
**Display products whose average unit price in sales transactions is lower than their listed price in the products table.**
```sql
select  product\_id  
from sales  
group by product\_id  
Having avg(unit\_price) \< ( select  unit\_pice  
                           from products  
			   where sales.product\_id \= products.product\_id)--correlated subquery  
```
                                          
**Find the average discount and total revenue generated for each subcategory across all stores.**
```sql 
select subcategory,  
ROUND(sum(net\_sales ::numeric),2) as total\_revenue,  
ROUND(avg (discount\_percentage ::numeric \* 100),2) as avg\_discount  
from global\_sales  
group by subcategory
```
**Retrieve the top three products by total sales revenue in each store.** 
```sql
With t1 AS  
(select store\_id,store\_name,product\_id,product\_name,  
sum(net\_sales) as total\_sales\_revenue  
from global\_sales  
group by product\_id,product\_name,store\_id,store\_name),  
t2 AS  
(select \*,   
DENSE\_RANK() OVER (PARTITION BY store\_id ORDER BY total\_sales\_revenue DESC) as revenue\_ranks  
from t1)  
select \* from t2  
where revenue\_ranks \<=3;
```
**MEDIUM TO ADVANCED QUERIES:**  

**Identify each store’s top-selling product and categorize it as “Top Performer” or “Underperformer” based on a specified sales quantity threshold.**
```sql
WITH sales\_t1 AS (  
    SELECT   
        store\_id,  
        product\_id,  
        SUM(net\_sales) AS total\_sale  
    FROM   
        sales  
    GROUP BY   
        store\_id, product\_id  
)  
SELECT   
    s1.store\_id,  
    s1.product\_id,  
    s1.total\_sale,  
	CASE  
    WHEN total\_sale between 2000 and 5000 THEN 'Under performer'  
    ELSE 'Top Performer'  
	END as store\_performance  
FROM   
    sales\_t1 AS s1  
WHERE   
    s1.total\_sale \= (  
        SELECT   
            MAX(total\_sale)  
        FROM   
            sales\_t1 AS s2  
        WHERE   
            s2.store\_id \= s1.store\_id  
    )  
ORDER BY   
    s1.total\_sale;
```
 **List the top five products by sales quantity within each store.**
```sql
WITH t1   
AS  
(select product\_id,store\_id,  
sum(qty) as total\_qty  
from sales  
group by product\_id,store\_id),  
t2 as  
(select \*,  
DENSE\_RANK ()OVER (partition by store\_id order by  total\_qty DESC) as ranks  
from t1)  
select st.store\_name,st.city,st.country,t2.\*  
from t2  
join stores as st on st.store\_id \= t2.store\_id  
where ranks \<= 5
```
**Find the top five stores by sales quantity for products in the "Kitchen" category, with rankings adjusted based on discount levels.**
```sql
WITH t1 AS  
(select store\_id,store\_name,product\_id,product\_name,  
sum(qty) as qty\_sold,  
avg (discount\_percentage \* 100\) as avg\_discount  
from global\_sales  
where category \= 'Kitchen'  
group by store\_id,store\_name,product\_id,product\_name),  
t2 AS  
(select store\_id,store\_name,product\_id,product\_name,qty\_sold,avg\_discount,   
DENSE\_RANK() OVER (PARTITION BY store\_id ORDER BY qty\_sold DESC,avg\_discount DESC) as ranks  
from t1)  
select store\_id,store\_name,product\_id,product\_name,qty\_sold,avg\_discount  
from t2  
where ranks \<= 5
```
**Identify stores with sales for all products in the "Furniture" category,regardless of stock level.**
```sql
WITH furniture\_products AS (  
    SELECT DISTINCT product\_id  
    FROM products  
    WHERE category \= 'Furniture'  
)

SELECT s.store\_id, s.store\_name,COUNT(DISTINCT s.product\_id)  
FROM global\_sales s  
JOIN furniture\_products fp ON s.product\_id \= fp.product\_id  
GROUP BY s.store\_id, s.store\_name  
HAVING COUNT(DISTINCT s.product\_id) \= (SELECT COUNT(\*) FROM furniture\_products);
```
**Find the average sales revenue generated by each product in stores      where it sold above the average sales quantity.**
```sql
With sales as   
(select product\_id,product\_name,store\_id,  
avg(net\_sales) as avg\_revenue,  
sum(qty) as total\_quantity\_sold \-- very important to use sum aggregation function   
from global\_sales  
group by product\_id,product\_name,store\_id)  
select \*  
from sales as t1  
where total\_quantity\_sold \> (select   
                              avg(qty)  
			     from global\_sales as t2  
			    where t1.product\_id \= t2.product\_id) 

```
